<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avanceret GTM Sandbox</title>

    <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5ZXM3K57');
    </script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f8f8f8; color: #333; }
        .container { max-width: 1200px; margin: auto; padding: 20px; }
        .header { text-align: center; padding: 20px 0; border-bottom: 1px solid #ddd; }
        .header h1 { margin: 0; }
        .nav { background-color: #333; color: #fff; padding: 10px; text-align: center; display: flex; justify-content: center; align-items: center; }
        .nav a { color: #fff; text-decoration: none; padding: 0 15px; }
        .search-bar { margin-left: 20px; }
        .search-bar input { border: 1px solid #ccc; padding: 5px; border-radius: 4px; }
        .search-bar button { padding: 5px 10px; background-color: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
        .promotion-banner { background-color: #e9ecef; border: 1px solid #ccc; padding: 15px; text-align: center; margin-bottom: 20px; cursor: pointer; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
        .product-card { background: #fff; border: 1px solid #ddd; padding: 15px; text-align: center; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .product-card img { max-width: 100%; height: auto; border-radius: 4px; }
        .product-card h3 { margin: 10px 0 5px; }
        .product-card .price { font-size: 1.2em; color: #007bff; font-weight: bold; }
        .product-card button, .checkout-btn { padding: 10px 20px; border: none; background-color: #007bff; color: #fff; cursor: pointer; border-radius: 5px; font-size: 1em; margin-top: 10px; }
        .product-card button:hover, .checkout-btn:hover { background-color: #0056b3; }
        .product-details { display: none; text-align: left; }
        .product-details img { float: left; margin-right: 20px; width: 400px; }
        .product-details-info { overflow: hidden; }
        #cart-view { display: none; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .cart-item .remove-btn { background-color: #dc3545; padding: 5px 10px; }
        .cart-item .remove-btn:hover { background-color: #c82333; }
        .checkout-container { text-align: right; margin-top: 20px; }
        .purchase-btn { background-color: #28a745; }
        .purchase-btn:hover { background-color: #218838; }
        .back-btn { background-color: #6c757d; }
        .back-btn:hover { background-color: #5a6268; }
        .quantity-selector { margin: 15px 0; }
        .quantity-selector label { margin-right: 10px; }
        .quantity-selector input { width: 50px; text-align: center; }
    </style>
</head>
<body>

    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5ZXM3K57"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div class="header">
        <h1>Min fiktive tøjbutik</h1>
        <p>Øv dig med e-handelssporing i GTM</p>
    </div>

    <div class="nav">
        <a href="#" onclick="showPage('home-view')">Hjem</a>
        <a href="#" onclick="showPage('cart-view')">Kurv (<span id="cart-count">0</span>)</a>
        <div class="search-bar">
            <input type="text" id="search-input" placeholder="Søg efter produkter...">
            <button onclick="performSearch()">Søg</button>
        </div>
    </div>

    <div class="container">

        <div id="promotion-banner" class="promotion-banner" onclick="trackPromotionClick()">
            <h3>20% rabat på alle T-shirts!</h3>
            <p>Klik her for at se tilbuddet.</p>
        </div>

        <div id="home-view">
            <h2>Populære produkter</h2>
            <div id="product-list" class="product-grid">
                <div class="product-card" data-id="SKU101" data-name="Blå T-shirt" data-price="149.00" data-category="T-shirts">
                    <img src="https://via.placeholder.com/250x250.png?text=Blå+T-shirt" alt="Blå T-shirt">
                    <h3>Blå T-shirt</h3>
                    <p class="price">149,00 DKK</p>
                    <button class="view-details-btn" onclick="showProductDetails('SKU101')">Se detaljer</button>
                </div>
                <div class="product-card" data-id="SKU102" data-name="Grå Hættetrøje" data-price="349.50" data-category="Hoodies">
                    <img src="https://via.placeholder.com/250x250.png?text=Grå+Hættetrøje" alt="Grå Hættetrøje">
                    <h3>Grå Hættetrøje</h3>
                    <p class="price">349,50 DKK</p>
                    <button class="view-details-btn" onclick="showProductDetails('SKU102')">Se detaljer</button>
                </div>
                <div class="product-card" data-id="SKU103" data-name="Sorte Jeans" data-price="599.00" data-category="Jeans">
                    <img src="https://via.placeholder.com/250x250.png?text=Sorte+Jeans" alt="Sorte Jeans">
                    <h3>Sorte Jeans</h3>
                    <p class="price">599,00 DKK</p>
                    <button class="view-details-btn" onclick="showProductDetails('SKU103')">Se detaljer</button>
                </div>
                <div class="product-card" data-id="SKU104" data-name="Hvid T-shirt" data-price="129.00" data-category="T-shirts">
                    <img src="https://via.placeholder.com/250x250.png?text=Hvid+T-shirt" alt="Hvid T-shirt">
                    <h3>Hvid T-shirt</h3>
                    <p class="price">129,00 DKK</p>
                    <button class="view-details-btn" onclick="showProductDetails('SKU104')">Se detaljer</button>
                </div>
                <div class="product-card" data-id="SKU105" data-name="Sorte Sneakers" data-price="899.00" data-category="Sko">
                    <img src="https://via.placeholder.com/250x250.png?text=Sorte+Sneakers" alt="Sorte Sneakers">
                    <h3>Sorte Sneakers</h3>
                    <p class="price">899,00 DKK</p>
                    <button class="view-details-btn" onclick="showProductDetails('SKU105')">Se detaljer</button>
                </div>
            </div>
        </div>

        <div id="product-details-view" class="product-details">
            <button onclick="showPage('home-view')" class="back-btn">Tilbage til produkter</button>
            <div id="product-details-content"></div>
        </div>

        <div id="cart-view">
            <h2>Din indkøbskurv</h2>
            <div id="cart-items">
                <p id="empty-cart-message">Din kurv er tom.</p>
            </div>
            <div class="checkout-container">
                <h3>Total: <span id="cart-total">0,00</span> DKK</h3>
                <button id="begin-checkout-btn" class="checkout-btn" onclick="beginCheckout()">Gå til betaling</button>
                <div id="checkout-view" style="display:none; margin-top: 20px;">
                    <p>Simuleret betalingsproces. Klik nedenfor for at gennemføre købet.</p>
                    <button id="purchase-btn" class="checkout-btn purchase-btn" onclick="simulatePurchase()">Gennemfør køb</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const products = {
            'SKU101': { id: 'SKU101', name: 'Blå T-shirt', price: 149.00, category: 'T-shirts' },
            'SKU102': { id: 'SKU102', name: 'Grå Hættetrøje', price: 349.50, category: 'Hoodies' },
            'SKU103': { id: 'SKU103', name: 'Sorte Jeans', price: 599.00, category: 'Jeans' },
            'SKU104': { id: 'SKU104', name: 'Hvid T-shirt', price: 129.00, category: 'T-shirts' },
            'SKU105': { id: 'SKU105', name: 'Sorte Sneakers', price: 899.00, category: 'Sko' }
        };
        let cart = [];

        function showPage(pageId) {
            document.querySelectorAll('.container > div:not(.promotion-banner)').forEach(div => div.style.display = 'none');
            document.getElementById(pageId).style.display = 'block';

            if (pageId === 'home-view') {
                dataLayer.push({
                    'event': 'view_item_list',
                    'ecommerce': {
                        'items': Object.values(products).map(p => ({
                            'item_id': p.id,
                            'item_name': p.name,
                            'item_category': p.category,
                            'price': p.price
                        }))
                    }
                });
            }
        }

        function performSearch() {
            const searchTerm = document.getElementById('search-input').value;
            if (searchTerm) {
                dataLayer.push({
                    'event': 'search',
                    'ecommerce': {
                        'search_term': searchTerm
                    }
                });
                alert(`Du søgte efter: "${searchTerm}". Tjek GTM Preview.`);
            }
        }

        function trackPromotionClick() {
            dataLayer.push({
                'event': 'select_promotion',
                'ecommerce': {
                    'promotions': [{
                        'creative_name': '20pct_tshirts_banner',
                        'creative_slot': 'banner_top',
                        'promotion_id': 'PROMO_TSHIRT20',
                        'promotion_name': '20% rabat på T-shirts'
                    }]
                }
            });
            alert('Du klikkede på kampagnebanneret. Tjek GTM Preview.');
        }

        function showProductDetails(productId) {
            const product = products[productId];
            if (!product) return;

            document.getElementById('product-details-content').innerHTML = `
                <img src="https://via.placeholder.com/400x400.png?text=${product.name.replace(/ /g, '+')}" alt="${product.name}">
                <div class="product-details-info">
                    <h2>${product.name}</h2>
                    <p><strong>ID:</strong> ${product.id}</p>
                    <p><strong>Kategori:</strong> ${product.category}</p>
                    <p class="price"><strong>Pris:</strong> ${product.price.toFixed(2)} DKK</p>
                    <p>Dette er en detaljeret beskrivelse af produktet.</p>
                    <div class="quantity-selector">
                        <label for="product-quantity">Antal:</label>
                        <input type="number" id="product-quantity" value="1" min="1">
                    </div>
                    <button id="add-to-cart-btn" onclick="addToCart('${productId}')">Tilføj til kurv</button>
                </div>
            `;
            showPage('product-details-view');

            dataLayer.push({
                'event': 'view_item',
                'ecommerce': {
                    'items': [{
                        'item_id': product.id,
                        'item_name': product.name,
                        'item_category': product.category,
                        'price': product.price
                    }]
                }
            });
        }

        function addToCart(productId) {
            const quantityInput = document.getElementById('product-quantity');
            const quantity = parseInt(quantityInput.value, 10);
            if (quantity < 1) {
                alert('Vælg venligst et gyldigt antal.');
                return;
            }
            
            const product = products[productId];
            if (!product) return;
            
            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({ ...product, quantity: quantity });
            }
            
            updateCart();
            alert(`${quantity} x ${product.name} er tilføjet til kurven.`);

            dataLayer.push({
                'event': 'add_to_cart',
                'ecommerce': {
                    'items': [{
                        'item_id': product.id,
                        'item_name': product.name,
                        'item_category': product.category,
                        'price': product.price,
                        'quantity': quantity
                    }]
                }
            });
        }

        function removeFromCart(productId) {
            const itemIndex = cart.findIndex(item => item.id === productId);
            if (itemIndex > -1) {
                const removedItem = cart[itemIndex];
                cart.splice(itemIndex, 1);
                updateCart();

                dataLayer.push({
                    'event': 'remove_from_cart',
                    'ecommerce': {
                        'items': [{
                            'item_id': removedItem.id,
                            'item_name': removedItem.name,
                            'item_category': removedItem.category,
                            'price': removedItem.price,
                            'quantity': removedItem.quantity
                        }]
                    }
                });
                alert(`${removedItem.name} er fjernet fra kurven.`);
            }
        }

        function updateCart() {
            const cartItemsContainer = document.getElementById('cart-items');
            const cartTotalSpan = document.getElementById('cart-total');
            const cartCountSpan = document.getElementById('cart-count');
            const emptyMessage = document.getElementById('empty-cart-message');

            cartItemsContainer.innerHTML = '';
            let total = 0;
            let totalItems = 0;

            if (cart.length > 0) {
                emptyMessage.style.display = 'none';
                cart.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'cart-item';
                    itemDiv.innerHTML = `
                        <span>${item.name} (${item.quantity})</span>
                        <span>${(item.price * item.quantity).toFixed(2)} DKK</span>
                        <button class="remove-btn" onclick="removeFromCart('${item.id}')">Fjern</button>
                    `;
                    cartItemsContainer.appendChild(itemDiv);
                    total += item.price * item.quantity;
                    totalItems += item.quantity;
                });
            } else {
                emptyMessage.style.display = 'block';
            }

            cartTotalSpan.textContent = total.toFixed(2);
            cartCountSpan.textContent = totalItems;
        }

        function beginCheckout() {
            if (cart.length === 0) {
                alert('Din kurv er tom!');
                return;
            }
            document.getElementById('begin-checkout-btn').style.display = 'none';
            document.getElementById('checkout-view').style.display = 'block';

            dataLayer.push({
                'event': 'begin_checkout',
                'ecommerce': {
                    'items': cart.map(item => ({
                        'item_id': item.id,
                        'item_name': item.name,
                        'item_category': item.category,
                        'price': item.price,
                        'quantity': item.quantity
                    }))
                }
            });
        }

        function simulatePurchase() {
            if (cart.length === 0) return;
            
            dataLayer.push({
                'event': 'purchase',
                'ecommerce': {
                    'transaction_id': 'T' + Math.floor(Math.random() * 1000000),
                    'value': parseFloat(document.getElementById('cart-total').textContent),
                    'currency': 'DKK',
                    'tax': 0,
                    'shipping': 0,
                    'items': cart.map(item => ({
                        'item_id': item.id,
                        'item_name': item.name,
                        'item_category': item.category,
                        'price': item.price,
                        'quantity': item.quantity
                    }))
                }
            });

            alert('Tak for dit køb! Du kan nu se et "purchase" event i GTM Preview.');
            cart = [];
            updateCart();
            document.getElementById('begin-checkout-btn').style.display = 'block';
            document.getElementById('checkout-view').style.display = 'none';
            showPage('home-view');
        }

        document.addEventListener("DOMContentLoaded", function() {
            showPage('home-view');
        });
    </script>
</body>
</html>
